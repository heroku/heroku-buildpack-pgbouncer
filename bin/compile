#!/usr/bin/env bash

set -e

mkdir -p "$1/bin/"

cp bin/pgbouncer "$1/bin/pgbouncer"
chmod +x "$1/bin/pgbouncer"
pgbouncer_version=$(./bin/pgbouncer -V 2>&1)
echo "-----> pgbouncer-buildpack: Installed ${pgbouncer_version} to app/bin"


cp bin/stunnel "$1/bin/stunnel"
chmod +x "$1/bin/stunnel"
echo "-----> pgbouncer-buildpack: Installed stunnel to app/bin"


cp bin/start-pgbouncer "$1/bin/"
chmod +x $1/bin/start-pgbouncer
echo '-----> pgbouncer-buildpack: Added start-pgbouncer to app/bin'


cp bin/start-pgbouncer-stunnel "$1/bin/"
chmod +x "$1/bin/start-pgbouncer-stunnel"
echo '-----> pgbouncer-buildpack: Added start-pgbouncer-stunnel to app/bin'


echo "-----> Moving the configuration generation scripts into app/bin"
cp bin/gen-pgbouncer-conf.sh "$1/bin/"
chmod +x "$1/bin/gen-pgbouncer-conf.sh"
cp bin/gen-pgbouncer-stunnel-conf.sh "$1/bin/"
chmod +x "$1/bin/gen-pgbouncer-stunnel-conf.sh"

mkdir -p "$1/config/"

echo "-----> pgbouncer-buildpack: done"

exit 0
